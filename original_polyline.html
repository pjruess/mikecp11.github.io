<!DOCTYPE html>
<html>
  <head>
    <link rel="icon" href="images/logo.png" >
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1.0, width=device-width, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="translucent-black">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Flood HIPPO</title>
    <link rel="stylesheet" href="https://js.arcgis.com/3.17/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="https://js.arcgis.com/3.17/esri/css/esri.css">
    <style>
      html, body {
        height: 100%;
        margin: 0px;
        padding: 0px;
        width: 100%;
      }
     @-webkit-keyframes pulse {
        0%   {opacity: 1.0;}
        45%  {opacity: .20;}
        100% {opacity: 1.0;}
      }
     @-moz-keyframes pulse {
        0%   {opacity: 1.0;}
        45%  {opacity: .20;}
        100% {opacity: 1.0;}
      }
    </style>
<script src="https://js.arcgis.com/3.17/"></script>
    <script>
      var map, graphic, currLocation, startPoint, stopPoint, lon, lat, csv, shelters, routeParams, params, incidents;
      var closestFacilityTask;
      var stopsArray = [];
      var destinationArray = [];
      require([
        "esri/urlUtils",
        "esri/map",
        "esri/dijit/Directions",
        "esri/geometry/Point",
        "esri/geometry/Polyline",
        "esri/tasks/FeatureSet",
        "esri/tasks/ClosestFacilityTask",
        "esri/tasks/ClosestFacilityParameters", 
        "esri/tasks/RouteParameters",
        "esri/layers/GraphicsLayer",
        "esri/symbols/SimpleFillSymbol",   
        "esri/symbols/SimpleMarkerSymbol",
        "esri/symbols/SimpleLineSymbol",
        "esri/graphic",
        "esri/Color",        
        "dojo/parser",
        "esri/layers/CSVLayer",
        "esri/renderers/SimpleRenderer",
        "esri/InfoTemplate",
        "dijit/layout/BorderContainer",
        "dijit/layout/ContentPane",
        "dojo/domReady!"
      ], function(
        urlUtils,
        Map,
        Directions,
        Point,
        Polyline,
        FeatureSet, 
        ClosestFacilityTask, 
        ClosestFacilityParameters,
        RouteParameters,
        GraphicsLayer,
        SimpleFillSymbol,
        SimpleMarkerSymbol,
        SimpleLineSymbol,
        Graphic,
        Color,
        parser,
        CSVLayer,
        SimpleRenderer,
        InfoTemplate
      ) {
        parser.parse();
        //all requests to route.arcgis.com will proxy to the proxyUrl defined in this object.
        urlUtils.addProxyRule({
          urlPrefix: "route.arcgis.com",
          proxyUrl: "/sproxy/"
        });
        urlUtils.addProxyRule({
          urlPrefix: "traffic.arcgis.com",
          proxyUrl: "/sproxy/"
        });
        // urlUtils.addProxyRule({
        //   urlPrefix: "mikecp11.github.io",
        //   proxyUrl: "/proxy/"
        // });

        var map = new Map("map", {
          basemap: "streets",
        });
        
        map.on("load", initFunc);

        routeParams = new RouteParameters();
        polygonFeatureSet = new FeatureSet();
        
        var polygonBarrierSymbol = new SimpleLineSymbol();
        var polygonGraphicsLayer = new GraphicsLayer();
        var polygonRenderer = new SimpleRenderer(polygonBarrierSymbol);
        polygonGraphicsLayer.setRenderer(polygonRenderer);

        map.addLayer(polygonGraphicsLayer);

        var polylineJSON = {"paths":

        [
          [
            [
              -9744403.1952372417,
              3920906.7621796131
            ],
            [
              -9744352.3777016923,
              3920901.1157867759
            ],
            [
              -9744323.2046720292,
              3920956.6386496946
            ],
            [
              -9744317.0877464507,
              3921021.1016345993
            ],
            [
              -9744343.9081124291,
              3921084.623554036
            ],
            [
              -9744376.6571908984,
              3921179.4829537272
            ],
            [
              -9744402.2541717682,
              3921122.266172953
            ],
            [
              -9744412.7941050641,
              3921057.5208684057
            ],
            [
              -9744417.3112193365,
              3920988.6348757744
            ],
            [
              -9744403.1952372417,
              3920906.7621796131
            ]
          ],
          [
            [
              -9744355.5180653725,
              3921308.581069544
            ],
            [
              -9744345.7902433816,
              3921421.5249934196
            ]
          ],
          [
            [
              -9744345.7902433816,
              3921421.5249934196
            ],
            [
              -9744381.5507313628,
              3921442.2284338176
            ],
            [
              -9744397.5488443971,
              3921493.9870348349
            ],
            [
              -9744420.134415755,
              3921539.1581775546
            ],
            [
              -9744439.8967906889,
              3921587.1525166705
            ],
            [
              -9744471.8783126287,
              3921631.3972980604
            ],
            [
              -9744500.1249809749,
              3921679.3769330382
            ],
            [
              -9744510.4767011777,
              3921801.7154445425
            ],
            [
              -9744507.6535047591,
              3921881.8942228556
            ],
            [
              -9744502.00711192,
              3922002.1623903289
            ],
            [
              -9744499.1250345577,
              3922061.1170854419
            ],
            [
              -9744417.3112193365,
              3922067.0959079564
            ],
            [
              -9744389.0792551469,
              3922021.9247652516
            ],
            [
              -9744378.5930970199,
              3921936.4222451299
            ],
            [
              -9744335.4385231789,
              3921911.8201049045
            ],
            [
              -9744270.5050055347,
              3921914.6433013156
            ],
            [
              -9744187.6912438963,
              3921907.1147775352
            ],
            [
              -9744137.8147738203,
              3921889.2345335558
            ],
            [
              -9744099.7016221676,
              3921848.2981854677
            ],
            [
              -9744034.7513833009,
              3921822.8176202625
            ],
            [
              -9744078.5276490152,
              3921807.3618373796
            ],
            [
              -9744184.3975147381,
              3921803.1270427629
            ],
            [
              -9744247.9194341823,
              3921784.776266031
            ],
            [
              -9744290.83201975,
              3921759.932137534
            ],
            [
              -9744310.0297554079,
              3921717.0195519626
            ],
            [
              -9744304.3833625689,
              3921642.4871664867
            ],
            [
              -9744303.148214126,
              3921587.7994991913
            ],
            [
              -9744332.6153267603,
              3921556.0973560661
            ],
            [
              -9744345.0373909939,
              3921497.9395098165
            ],
            [
              -9744345.7902433816,
              3921421.5249934196
            ]
          ],
          [
            [
              -9745594.0194869228,
              3924266.9305579215
            ],
            [
              -9745597.4119823892,
              3924223.9589486122
            ],
            [
              -9745711.1418069471,
              3924228.8577376306
            ],
            [
              -9745768.6812387314,
              3924250.3678055927
            ],
            [
              -9745802.5595957525,
              3924294.2841943279
            ],
            [
              -9745710.3351793978,
              3924291.7746864036
            ],
            [
              -9745594.0194869228,
              3924266.9305579215
            ]
          ],
          [
            [
              -9745951.8936406355,
              3924416.9827207699
            ],
            [
              -9745906.5473305359,
              3924389.1749628708
            ],
            [
              -9745889.921840515,
              3924347.0128954127
            ],
            [
              -9745953.1300714593,
              3924365.1777933165
            ],
            [
              -9745951.8936406355,
              3924416.9827207699
            ]
          ],
          [
            [
              -9745951.8936406355,
              3924416.9827207699
            ],
            [
              -9745995.4780177511,
              3924418.8185252696
            ],
            [
              -9746071.7043210715,
              3924415.9953288436
            ],
            [
              -9746144.2604690492,
              3924411.2562983781
            ],
            [
              -9746264.3090545703,
              3924421.0143447071
            ],
            [
              -9746328.6151952278,
              3924449.8736858815
            ],
            [
              -9746416.1342842318,
              3924461.1664715633
            ],
            [
              -9746461.3054269422,
              3924449.8736858815
            ],
            [
              -9746514.5428451393,
              3924435.3543900251
            ],
            [
              -9746568.5868908782,
              3924415.9953288585
            ],
            [
              -9746619.4044264201,
              3924393.4097575024
            ],
            [
              -9746674.2550997157,
              3924369.2109310403
            ],
            [
              -9746706.9235154223,
              3924339.7690255344
            ],
            [
              -9746758.6821164452,
              3924331.2994362712
            ],
            [
              -9746808.1552727427,
              3924341.7855944037
            ],
            [
              -9746872.362825593,
              3924330.1701577082
            ],
            [
              -9746936.4493843131,
              3924303.3497917354
            ],
            [
              -9747001.7458843607,
              3924278.8686456308
            ],
            [
              -9747054.1766750012,
              3924257.8963293657
            ],
            [
              -9747101.2299486585,
              3924237.1928889602
            ],
            [
              -9747158.0703032352,
              3924224.0179723352
            ],
            [
              -9747229.59127919,
              3924213.1016128585
            ],
            [
              -9747367.5514775515,
              3924195.7860081494
            ],
            [
              -9747401.42983458,
              3924153.4380618557
            ],
            [
              -9747470.5981468558,
              3924149.2032672241
            ],
            [
              -9747527.3443948831,
              3924130.0507468358
            ],
            [
              -9747579.2912089974,
              3924111.0901155621
            ],
            [
              -9747645.6363248546,
              3924081.4465531632
            ],
            [
              -9747665.8839366753,
              3924175.0972718894
            ],
            [
              -9747641.401530223,
              3924235.3107580245
            ],
            [
              -9747605.1032905467,
              3924272.4156252518
            ],
            [
              -9747556.705637645,
              3924286.1282935664
            ],
            [
              -9747507.5820199437,
              3924313.2309792042
            ],
            [
              -9747457.8937629666,
              3924334.1226326972
            ],
            [
              -9747404.2530309986,
              3924348.2386147827
            ],
            [
              -9747326.6151294652,
              3924372.2357843593
            ],
            [
              -9747272.127438575,
              3924391.1512003615
            ],
            [
              -9747222.1568619497,
              3924414.583730638
            ],
            [
              -9747175.5741210319,
              3924435.757703796
            ],
            [
              -9747145.6482389886,
              3924467.9421429634
            ],
            [
              -9747093.7014248744,
              3924483.7520429119
            ],
            [
              -9747048.530282164,
              3924500.6912214383
            ],
            [
              -9747003.3591394518,
              3924511.9840071052
            ],
            [
              -9746959.1290622074,
              3924549.6266260371
            ],
            [
              -9746915.8400504496,
              3924626.3234620988
            ]
          ],
          [
            [
              -9746109.3469399977,
              3924510.1018761545
            ],
            [
              -9746066.5871431697,
              3924504.6550414637
            ]
          ],
          [
            [
              -9746915.8400504496,
              3924626.3234620988
            ],
            [
              -9746891.5605612509,
              3924549.2501998544
            ],
            [
              -9746815.6165775582,
              3924561.3899444491
            ],
            [
              -9746742.7781099454,
              3924596.3975800574
            ],
            [
              -9746679.0948650036,
              3924622.4919812381
            ],
            [
              -9746623.1686883122,
              3924639.968911469
            ],
            [
              -9746561.058367094,
              3924656.908089973
            ],
            [
              -9746546.5592730101,
              3924716.6657475159
            ],
            [
              -9746522.0041499548,
              3924780.1876669526
            ],
            [
              -9746496.037428692,
              3924695.4917743877
            ],
            [
              -9746430.7207990661,
              3924688.43378333
            ],
            [
              -9746397.3129747715,
              3924759.0809127763
            ],
            [
              -9746318.7340077646,
              3924751.9557027519
            ]
          ],
          [
            [
              -9746847.6800226159,
              3924661.2101035714
            ],
            [
              -9746915.8400504496,
              3924626.3234620988
            ]
          ],
          [
            [
              -9746318.7340077646,
              3924751.9557027519
            ],
            [
              -9746336.5096742716,
              3924798.7573525384
            ],
            [
              -9746333.6969487779,
              3924834.957677491
            ]
          ],
          [
            [
              -9746318.7340077646,
              3924751.9557027519
            ],
            [
              -9746276.1523012016,
              3924745.2574567869
            ],
            [
              -9746221.3337312993,
              3924768.8948812783
            ],
            [
              -9746178.9857850075,
              3924799.9500418827
            ],
            [
              -9746146.9895589259,
              3924830.0641370192
            ],
            [
              -9746112.842317313,
              3924897.7708055004
            ],
            [
              -9746098.8781213183,
              3924835.877612792
            ],
            [
              -9746045.354487814,
              3924875.2352797464
            ],
            [
              -9745994.0664195381,
              3924902.996711202
            ],
            [
              -9745938.0730238911,
              3924926.0528152809
            ],
            [
              -9745879.5387514606,
              3924956.73154971
            ],
            [
              -9745807.781865824,
              3924985.8582613096
            ],
            [
              -9745747.7921584528,
              3925012.4451989308
            ],
            [
              -9745692.1412469111,
              3925047.1365728229
            ],
            [
              -9745628.8657970037,
              3925074.2034083307
            ],
            [
              -9745598.8189208303,
              3925130.2640229538
            ],
            [
              -9745561.270408459,
              3925102.5966980308
            ],
            [
              -9745503.30077531,
              3925112.3837789595
            ],
            [
              -9745461.8938944917,
              3925138.7336122021
            ],
            [
              -9745417.8520303518,
              3925145.5092836171
            ],
            [
              -9745360.2588233929,
              3925158.4959871396
            ],
            [
              -9745293.3087368794,
              3925167.7722039521
            ],
            [
              -9745254.517284777,
              3925220.9142934456
            ]
          ],
          [
            [
              -9742655.6366536729,
              3924766.0716848522
            ],
            [
              -9742655.6366536729,
              3924722.9663692564
            ],
            [
              -9742697.5812861938,
              3924746.7126236856
            ],
            [
              -9742757.2717247643,
              3924752.8967682347
            ],
            [
              -9742804.7955311611,
              3924691.1291700825
            ],
            [
              -9742870.1995815448,
              3924709.6077564582
            ],
            [
              -9742862.1333060581,
              3924758.0054093599
            ],
            [
              -9742845.1045022532,
              3924821.2808592767
            ],
            [
              -9742870.1995815448,
              3924890.2923273146
            ],
            [
              -9742863.9258117191,
              3924951.7752715349
            ],
            [
              -9742791.3181076646,
              3924998.8156815842
            ],
            [
              -9742782.6887636203,
              3924935.5020684004
            ],
            [
              -9742788.2469315734,
              3924890.8161625713
            ],
            [
              -9742751.6253319252,
              3924845.1211846024
            ],
            [
              -9742696.2035600357,
              3924808.3203781471
            ],
            [
              -9742661.2830465101,
              3924799.9500418827
            ],
            [
              -9742655.6366536729,
              3924766.0716848522
            ]
          ],
          [
            [
              -9746333.6969487779,
              3924834.957677491
            ],
            [
              -9746362.4935522638,
              3924912.8778986558
            ],
            [
              -9746320.1927107256,
              3924935.7294137552
            ],
            [
              -9746316.38134408,
              3924882.7638035193
            ],
            [
              -9746333.6969487779,
              3924834.957677491
            ]
          ],
          [
            [
              -9745905.7003716119,
              3925102.5966980308
            ],
            [
              -9745958.9826505873,
              3925087.5127628893
            ],
            [
              -9745956.5984123722,
              3925162.2124605477
            ],
            [
              -9745898.9820463806,
              3925170.0881072655
            ],
            [
              -9745858.2169619929,
              3925257.0781150237
            ],
            [
              -9745868.2604861334,
              3925132.9126076028
            ],
            [
              -9745905.7003716119,
              3925102.5966980308
            ]
          ],
          [
            [
              -9745254.517284777,
              3925220.9142934456
            ],
            [
              -9745266.5287022777,
              3925287.7983831465
            ],
            [
              -9745213.5435915086,
              3925301.1759907827
            ],
            [
              -9745254.517284777,
              3925220.9142934456
            ]
          ],
          [
            [
              -9745254.517284777,
              3925220.9142934456
            ],
            [
              -9745201.0305453502,
              3925177.1290835068
            ],
            [
              -9745145.695895521,
              3925183.9047549069
            ],
            [
              -9745057.2357410528,
              3925186.7279513329
            ],
            [
              -9744993.2432888821,
              3925195.1975405812
            ],
            [
              -9744948.0721461773,
              3925195.1975405812
            ],
            [
              -9744891.6082177907,
              3925195.1975405812
            ],
            [
              -9744789.9731466938,
              3925195.1975405812
            ],
            [
              -9744727.8628254607,
              3925195.1975405812
            ],
            [
              -9744660.7334883846,
              3925196.4522945583
            ],
            [
              -9744660.1061114054,
              3925240.3686833009
            ],
            [
              -9744680.2718001101,
              3925293.6061014831
            ],
            [
              -9744731.6034289077,
              3925316.9230301455
            ],
            [
              -9744686.7248204965,
              3925350.8766574338
            ],
            [
              -9744713.4331548735,
              3925433.6007937789
            ],
            [
              -9744677.0452899188,
              3925460.1828300357
            ],
            [
              -9744613.8056901228,
              3925450.4144968987
            ],
            [
              -9744599.8779211268,
              3925349.5322781801
            ],
            [
              -9744609.288575856,
              3925296.83261168
            ],
            [
              -9744555.615092095,
              3925289.9627307728
            ],
            [
              -9744497.7723172884,
              3925286.9514242262
            ],
            [
              -9744518.9462904278,
              3925235.315051429
            ],
            [
              -9744571.3636372872,
              3925231.8049875051
            ],
            [
              -9744537.2970671616,
              3925171.200371027
            ],
            [
              -9744462.7646816894,
              3925146.9208818227
            ],
            [
              -9744391.9024515655,
              3925116.1480408534
            ],
            [
              -9744399.9015080817,
              3925165.5539781898
            ],
            [
              -9744365.6467248574,
              3925208.4665637612
            ],
            [
              -9744245.6608770452,
              3925226.8173404932
            ],
            [
              -9744183.9269820042,
              3925235.4657689482
            ],
            [
              -9744137.2501345389,
              3925309.2546759248
            ],
            [
              -9744123.6987917256,
              3925236.604421407
            ],
            [
              -9744133.1094464567,
              3925176.3762311265
            ],
            [
              -9744180.1627201121,
              3925150.0263978913
            ],
            [
              -9744278.0335293189,
              3925120.8533682227
            ],
            [
              -9744211.2178807221,
              3925087.9160766602
            ],
            [
              -9744082.2919109073,
              3925086.0339457169
            ],
            [
              -9744010.7709349524,
              3925093.5624694973
            ],
            [
              -9743965.5997922476,
              3925093.5624694973
            ],
            [
              -9743920.4286495373,
              3925093.5624694973
            ],
            [
              -9743857.5117007624,
              3925098.4022347927
            ],
            [
              -9743807.5007927567,
              3925104.8552551642
            ],
            [
              -9743762.3296500519,
              3925110.5016480163
            ],
            [
              -9743699.4127012789,
              3925125.8275714293
            ],
            [
              -9743627.6631808504,
              3925148.0501603931
            ],
            [
              -9743557.177376911,
              3925165.0834454447
            ],
            [
              -9743491.3027937934,
              3925183.9047549069
            ],
            [
              -9743417.8996868934,
              3925206.4903262705
            ],
            [
              -9743355.7893656678,
              3925229.0758976266
            ],
            [
              -9743306.1011086907,
              3925247.1443547159
            ],
            [
              -9743256.6638024952,
              3925288.0493339375
            ],
            [
              -9743182.6333186142,
              3925326.9467068315
            ],
            [
              -9743118.6408664435,
              3925364.5893257633
            ],
            [
              -9743042.979202399,
              3925396.2091256455
            ],
            [
              -9742991.0800848696,
              3925434.6509150192
            ],
            [
              -9742944.7319670096,
              3925473.0000682548
            ],
            [
              -9742905.489536779,
              3925507.1607449204
            ],
            [
              -9742856.0835994426,
              3925559.3898786828
            ],
            [
              -9742805.6693776585,
              3925593.6715495065
            ],
            [
              -9742757.2717247698,
              3925635.6161820143
            ],
            [
              -9742744.0968081411,
              3925699.6086341813
            ],
            [
              -9742767.3097564802,
              3925761.091578424
            ],
            [
              -9742767.5965573862,
              3925857.0757754222
            ],
            [
              -9742723.3933677357,
              3925782.4223958179
            ],
            [
              -9742709.2773856409,
              3925731.604860276
            ],
            [
              -9742656.8914076388,
              3925727.2132214084
            ],
            [
              -9742607.2390007712,
              3925767.9030999467
            ],
            [
              -9742561.5301063582,
              3925774.893872045
            ],
            [
              -9742517.3000291213,
              3925830.4167349488
            ],
            [
              -9742461.1497892272,
              3925870.2551733106
            ],
            [
              -9742412.5426240936,
              3925916.7254887596
            ],
            [
              -9742377.8341260105,
              3925956.3312952444
            ],
            [
              -9742331.9395392165,
              3925959.3132964596
            ],
            [
              -9742311.2066905126,
              3925917.9358239472
            ],
            [
              -9742277.3062772546,
              3925842.6579381675
            ],
            [
              -9742290.5032500997,
              3925767.3653482497
            ],
            [
              -9742342.6651649009,
              3925717.8921919465
            ],
            [
              -9742386.4919283595,
              3925688.315848507
            ],
            [
              -9742432.6041365378,
              3925638.4393784255
            ],
            [
              -9742483.9863113761,
              3925599.4792678431
            ],
            [
              -9742527.6517493315,
              3925564.0952060521
            ],
            [
              -9742574.8888248317,
              3925496.6912077367
            ]
          ],
          [
            [
              -9742767.3097564802,
              3925325.6919528693
            ],
            [
              -9742823.616840614,
              3925301.0674063116
            ],
            [
              -9742862.6710577533,
              3925278.0113022327
            ],
            [
              -9742900.3136766739,
              3925236.604421407
            ],
            [
              -9742953.0133431759,
              3925204.6081953272
            ],
            [
              -9743004.3014114574,
              3925176.8467638642
            ],
            [
              -9743050.8841523807,
              3925144.3800050393
            ],
            [
              -9743091.5381808188,
              3925111.6309265792
            ],
            [
              -9743132.1922092568,
              3925095.8210266307
            ],
            [
              -9743178.8690567166,
              3925086.0339457169
            ],
            [
              -9743252.9044419918,
              3925054.6699979901
            ],
            [
              -9743291.7969134971,
              3925012.6308388188
            ],
            [
              -9743338.8501871545,
              3925003.2201840803
            ],
            [
              -9743380.2570679728,
              3924976.8703508303
            ],
            [
              -9743434.8388654068,
              3924963.6954341978
            ],
            [
              -9743495.537588425,
              3924945.3446574807
            ],
            [
              -9743579.762948269,
              3924925.111749813
            ],
            [
              -9743661.2592182364,
              3924904.9729486853
            ],
            [
              -9743733.2910583131,
              3924895.13209261
            ],
            [
              -9743796.2080070879,
              3924884.6459344774
            ],
            [
              -9743852.1072961856,
              3924875.611705929
            ],
            [
              -9743905.8182978965,
              3924817.7159840986
            ],
            [
              -9743971.2461850867,
              3924845.1211845875
            ],
            [
              -9744101.1132203732,
              3924845.1211845875
            ],
            [
              -9744185.8091129512,
              3924845.1211845875
            ],
            [
              -9744266.7407436427,
              3924852.6497083828
            ],
            [
              -9744321.3225410841,
              3924867.706755951
            ],
            [
              -9744372.1400766317,
              3924873.3531487882
            ],
            [
              -9744444.1315853205,
              3924880.4111398458
            ],
            [
              -9744507.6535047591,
              3924890.2923272997
            ],
            [
              -9744552.8246474694,
              3924890.2923272997
            ],
            [
              -9744622.4634924717,
              3924894.0565891936
            ],
            [
              -9744679.8684863318,
              3924904.4083094075
            ],
            [
              -9744733.5092183053,
              3924912.8778986558
            ],
            [
              -9744778.6803610176,
              3924912.8778986558
            ],
            [
              -9744840.7906822413,
              3924912.8778986558
            ],
            [
              -9744910.429527251,
              3924912.8778986558
            ],
            [
              -9744959.3649318535,
              3924912.8778986558
            ],
            [
              -9745061.0000029523,
              3924912.8778986558
            ],
            [
              -9745132.9915116392,
              3924900.1735147759
            ],
            [
              -9745194.6313001309,
              3924882.7638035193
            ],
            [
              -9745241.6845737882,
              3924867.706755951
            ],
            [
              -9745288.7378474455,
              3924841.3569227085
            ],
            [
              -9745350.3776359297,
              3924823.9472114518
            ],
            [
              -9745419.5459481999,
              3924811.242827557
            ],
            [
              -9745492.9490551073,
              3924797.1268454716
            ],
            [
              -9745568.8930387851,
              3924774.2589544728
            ],
            [
              -9745635.3188173976,
              3924753.1656440794
            ],
            [
              -9745693.396000877,
              3924720.9005421475
            ],
            [
              -9745732.9207507502,
              3924675.7293994427
            ],
            [
              -9745776.3979756068,
              3924662.5893243253
            ],
            [
              -9745821.3809052259,
              3924631.4993221909
            ],
            [
              -9745847.783077091,
              3924553.7227718607
            ],
            [
              -9745902.3125359099,
              3924511.9840071127
            ],
            [
              -9745950.8569644615,
              3924460.0755686164
            ],
            [
              -9745951.8936406355,
              3924416.9827207699
            ]
          ],
          [
            [
              -9742719.836605005,
              3925351.9152691662
            ],
            [
              -9742737.3327702563,
              3925356.6669190601
            ],
            [
              -9742767.3097564802,
              3925325.6919528693
            ]
          ],
          [
            [
              -9742574.8888248317,
              3925496.6912077367
            ],
            [
              -9742629.8690127861,
              3925454.5727380589
            ],
            [
              -9742584.0917834733,
              3925438.560380362
            ],
            [
              -9742574.8888248317,
              3925496.6912077367
            ]
          ],
          [
            [
              -9742574.8888248317,
              3925496.6912077367
            ],
            [
              -9742516.6300713774,
              3925507.9023853987
            ],
            [
              -9742476.6986599136,
              3925547.0204736739
            ],
            [
              -9742424.1345472876,
              3925579.1522536203
            ],
            [
              -9742365.2507362459,
              3925598.5113148019
            ]
          ],
          [
            [
              -9745714.5699740164,
              3925594.6798339337
            ],
            [
              -9745783.2543097716,
              3925575.6030924171
            ],
            [
              -9745828.90942901,
              3925635.6161820143
            ],
            [
              -9745852.3771848921,
              3925733.8194208965
            ],
            [
              -9745849.6128694154,
              3925808.7722290605
            ],
            [
              -9745844.7193289585,
              3925870.5061240941
            ],
            [
              -9745813.099529054,
              3925902.1259240061
            ],
            [
              -9745773.6953531951,
              3925958.7104263976
            ],
            [
              -9745699.0423937086,
              3925969.8826380521
            ],
            [
              -9745727.2743579112,
              3925917.9358239472
            ],
            [
              -9745742.3314054795,
              3925859.5897646025
            ],
            [
              -9745749.859929271,
              3925788.0687886551
            ],
            [
              -9745712.0052489564,
              3925735.5804942846
            ],
            [
              -9745673.0689866617,
              3925706.760731779
            ],
            [
              -9745687.7496080324,
              3925658.2017533556
            ],
            [
              -9745714.5699740164,
              3925594.6798339337
            ]
          ],
          [
            [
              -9742365.2507362459,
              3925598.5113148019
            ],
            [
              -9742328.1458690278,
              3925550.9202894196
            ],
            [
              -9742298.3739795107,
              3925497.0229032487
            ],
            [
              -9742338.0270564966,
              3925447.8736201301
            ],
            [
              -9742401.266656287,
              3925426.9819666222
            ],
            [
              -9742470.1017817501,
              3925467.3106657937
            ],
            [
              -9742541.9864556249,
              3925401.8974253088
            ],
            [
              -9742505.0661779717,
              3925358.9429329112
            ],
            [
              -9742544.5909278449,
              3925326.9467068315
            ],
            [
              -9742572.0700396542,
              3925292.3154974058
            ],
            [
              -9742616.1119037997,
              3925274.2470403314
            ],
            [
              -9742657.2499087639,
              3925241.9819383994
            ],
            [
              -9742700.8077963833,
              3925217.7831119522
            ],
            [
              -9742743.1557426695,
              3925185.3163531274
            ],
            [
              -9742734.6861534119,
              3925087.9160766602
            ],
            [
              -9742724.1999952849,
              3925020.5130498633
            ],
            [
              -9742770.0504648536,
              3925057.1715411842
            ],
            [
              -9742793.0322127435,
              3925108.6195170656
            ],
            [
              -9742839.1116691343,
              3925111.7251360863
            ],
            [
              -9742832.5569626167,
              3925168.8477073386
            ],
            [
              -9742793.973278217,
              3925226.2527012154
            ],
            [
              -9742776.483915139,
              3925283.574224472
            ],
            [
              -9742767.3097564802,
              3925325.6919528693
            ]
          ],
          [
            [
              -9742365.2507362459,
              3925598.5113148019
            ],
            [
              -9742323.0341746379,
              3925627.4492636546
            ]
          ],
          [
            [
              -9742991.5970275756,
              3925598.9146285653
            ],
            [
              -9742977.4980625473,
              3925660.1872963682
            ]
          ],
          [
            [
              -9742977.4980625473,
              3925660.1872963682
            ],
            [
              -9743004.0429401044,
              3925705.0436548889
            ]
          ],
          [
            [
              -9743004.0429401044,
              3925705.0436548889
            ],
            [
              -9742964.3272660635,
              3925726.498844862
            ],
            [
              -9742977.4980625473,
              3925660.1872963682
            ]
          ],
          [
            [
              -9743004.0429401044,
              3925705.0436548889
            ],
            [
              -9743067.823330896,
              3925711.8424853384
            ],
            [
              -9743123.4022533763,
              3925739.4954737052
            ],
            [
              -9743078.189755246,
              3925760.7631857842
            ],
            [
              -9743026.1425853204,
              3925745.4203263447
            ],
            [
              -9743004.0429401044,
              3925705.0436548889
            ]
          ]
        ]     

        ,"spatialReference":{"wkid":102100}
        // ,"symbol":{"color":[0,255,255,100],"outline":{"color":[0,255,255,100],
        // "width":1,"type":"esriSLS","style":"esriSLSSolid"},
        // "type":"esriSFS","style":"esriSFSSolid"}
        };

        var polyline = new Polyline(polylineJSON);

        // var polygon = {"geometry":{"rings":[[[-87.546723,33.2216],[-87.546551,33.21862],
        // [-87.545393,33.214886],[-87.543547,33.213019],//[-87.538183,33.211978],[-87.537324,33.20986],
        // [-87.538655,33.2081],[-87.542861,33.207705],[-87.54638,33.206449],[-87.550585,33.205479],
        // [-87.553675,33.208603],[-87.553461,33.212122],[-87.556551,33.214815],[-87.560585,33.217472],
        // [-87.554061,33.219626],[-87.549813,33.220667],[-87.546723,33.2216]]],
        // "spatialReference":{"wkid":4326}},
        // "symbol":{"color":[0,255,255,100],"outline":{"color":[0,255,255,100],
        // "width":1,"type":"esriSLS","style":"esriSLSSolid"},
        // "type":"esriSFS","style":"esriSFSSolid"}};

        var polygonGraphic = new Graphic(polyline, polygonBarrierSymbol);
        polygonGraphicsLayer.add(polygonGraphic);
        
        polygonFeatureSet.features = polygonGraphicsLayer.graphics;
        routeParams.polylineBarriers = polygonFeatureSet;

        params = new ClosestFacilityParameters();
        params.impedenceAttribute= "Miles";
        params.defaultCutoff= 400;

        closestFacilityTask = new ClosestFacilityTask("https://utility.arcgis.com/usrsvcs/appservices/WxqHoL9WgtN2bZik/rest/services/World/ClosestFacility/NAServer/ClosestFacility_World");

        function initFunc(map) {
          if( navigator.geolocation ) {  
            navigator.geolocation.getCurrentPosition(findStart, locationError);
          } else {
            alert("Geolocation unknown.");
          }
        }

        function findStart(location) {
          var pt = new Point(location.coords.longitude, location.coords.latitude);
          map.centerAndZoom(pt, 12);
        }

        function locationError(error) {
          switch (error.code) {
            case error.PERMISSION_DENIED:
              alert("Location not provided");
              break;
            case error.POSITION_UNAVAILABLE:
              alert("Current location not available");
              break;
            case error.TIMEOUT:
              alert("Timeout");
              break;
            default:
              alert("unknown error");
              break;
          }
        }

        function solveClosestFacil(){
          console.log("solveClosestFacil started");
          console.log("params.facilities", params.facilities);
          console.log("params.incidents", params.incidents);
          /*
          closestFacilityTask.solve(params, function(solveResult){
            console.log("closestFacilityTask entered");
            array.forEach(solveResult.routes, function(route, index){
              var attr = array.map(solveResult.directions[index].features, function(feature){
                return feature.attributes.text;
              console.log("attr: ", attr);
              });
              route.setAttributes(attr);
              destinationArray.push(route.attributes[route.attributes.length - 1])
              console.log(destinationArray[0]);
              stopPoint = new Point(destinationArray[0]);
              return stopPoint;
            });
          });
          */
          stopsArray.push(startPoint);
          stopsArray.push(stopPoint);  
          console.log(stopsArray);                
          console.log("solveClosestFacil finished");
        }

        function initStart(position){
          console.log("initStart started");
          startPoint = new Point(position.coords.longitude, position.coords.latitude);
          var incidents = new FeatureSet();
          incidents.features = [startPoint];
          params.incidents = incidents;

          solveClosestFacil();
          console.log("initStart finished");
        }

        function initStops(){
          console.log("initStops started");
          shelters = new CSVLayer("https://mikecp11.github.io/RedCrossShelters.csv");
          var marker = new SimpleMarkerSymbol("solid", 6, null, new Color([238, 69, 0, 0.5]));
          var csvRenderer = new SimpleRenderer(marker);
          shelters.setRenderer(csvRenderer);
          var template = new InfoTemplate("${LABEL}");
          shelters.setInfoTemplate(template);
          map.addLayer(shelters);

          var facilities = new FeatureSet();
          stopPoint = new Point(-87.569, 33.210);
          facilities.features = [stopPoint];
          params.facilities = facilities;
          console.log("initStops finished");
        }

        initStops();
        
        navigator.geolocation.getCurrentPosition(initStart, locationError);

        setTimeout(startDirections, 5000);

        console.log("startDirections timeout finished");

        function startDirections(){
          console.log("startDirections started");
          var directions = new Directions({
            map: map,
            routeTaskUrl: "https://utility.arcgis.com/usrsvcs/appservices/UHoPnXFhxTAQ3pF3/rest/services/World/Route/NAServer/Route_World",
            routeParams: routeParams,
            dragging: true,
            canModifyStops: true,
            maxStops: 2,
            minStops: 2,
            showActivateButton: true,
            showTravelModesOption: false,
            showReturnToStartOption: false,
            traffic: false,
            directionsLengthUnits: "esriMiles",
            stops: stopsArray
          },"dir");
          directions.startup();
          console.log("startDirections finished");
        }
      });
    </script>
  </head>
  <body class="claro">
    <div data-dojo-type="dijit/layout/BorderContainer"
         data-dojo-props="design:'headline', gutters:false"
         style="width:100%;height:100%;">
      <div data-dojo-type="dijit/layout/ContentPane"
           data-dojo-props="region:'right'"
           style="width:250px;">
        <div id="dir"></div>
      </div>
      <div id="map"
         data-dojo-type="dijit/layout/ContentPane"
         data-dojo-props="region:'center'">
    </div>
    </div>
  </body>
</html>